(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[54],{66671:function(ne){ne.exports={red:"#ff4b4b",orange:"#ff8239",yellow:"#ffba14",blue:"#3390f5",gray:"#a0a0a0",hazard:"#b6b6b6",primaryColor:"#1890ff",success:"#52c41a",online:"#2ac785",offline:"#ff4b4b",legend:"legend___2yfND","minute-rain-play-ctrl":"minute-rain-play-ctrl___qP9VF","rain-legend":"rain-legend___1XdLk",fullscreen:"fullscreen___1Mx3f"}},56985:function(ne,V,n){"use strict";n.d(V,{j:function(){return I},l:function(){return S}});var b=n(98858),K=n(4914),$=n(11849),z=n(66671),X=n.n(z),R=n(85893),I=X().legend,te=[{value:1,label:"\u9AD8",color:"#ff0404"},{value:2,label:"\u4E2D",color:"rgb(227,255,55)"},{value:3,label:"\u4F4E",color:"rgb(105,245,84)"},{value:4,label:"\u6781\u4F4E",color:"rgb(125,140,235)"},{value:5,label:"\u65E0",color:"#071533"}],S=function(){return(0,R.jsx)(K.Z,{colon:!1,className:"heatmap",column:1,title:(0,R.jsx)("div",{className:"legend-title",children:"\u4EBA\u53E3\u5BC6\u5EA6\u56FE\u4F8B"}),children:te.map(function(w){var Z=w.color,N=w.value,L=w.label;return(0,R.jsx)(K.Z.Item,{label:(0,R.jsx)("div",{className:"legend-block",style:(0,$.Z)({backgroundColor:Z,height:12,top:5,width:12,borderRadius:"50%"},N===5?{border:"1px solid #3C3C3C"}:{})}),children:L},N)})})}},55121:function(ne,V,n){"use strict";n.d(V,{X:function(){return te},D:function(){return S}});var b=n(69610),K=n(54941),$=n(81306),z=n(6298),X=n(94184),R=n.n(X),I=n(73935),te=function(Y){(0,$.Z)(Z,Y);var w=(0,z.Z)(Z);function Z(N,L){var a,A=L.anchor,J=A===void 0?BMAP_ANCHOR_BOTTOM_LEFT:A,W=L.offset,Q=W===void 0?new BMapGL.Size(10,10):W,k=L.border,B=k===void 0?!0:k,e=L.center,ae=e===void 0?!1:e,q=L.className,oe=q===void 0?"":q;return(0,b.Z)(this,Z),a=w.call(this),a.dom=void 0,a.Dom=null,a.border=void 0,a.center=void 0,a.className=void 0,a.defaultAnchor=J,a.defaultOffset=Q,a.dom=N,a.border=B,a.center=ae,a.className=oe,a}return(0,K.Z)(Z,[{key:"initialize",value:function(L){var a=document.createElement("div");return a.className=R()(this.border&&"dom-control",this.center&&"control-center",this.className),I.render(this.dom,a),this.Dom=a,L.getContainer().appendChild(a),a}},{key:"update",value:function(L){I.render(L,this.Dom)}}]),Z}(BMapGL.Control),S=function(Y){(0,$.Z)(Z,Y);var w=(0,z.Z)(Z);function Z(N,L){var a,A=L.border,J=A===void 0?!0:A,W=L.center,Q=W===void 0?!1:W,k=L.className,B=k===void 0?"":k;return(0,b.Z)(this,Z),a=w.call(this),a.dom=void 0,a.Dom=null,a.border=void 0,a.center=void 0,a.className=void 0,a.dom=N,a.border=J,a.center=Q,a.className=B,a}return(0,K.Z)(Z,[{key:"onAdd",value:function(L){var a=document.createElement("div");return a.className=R()(this.border&&"dom-control",this.center&&"control-center",this.className),I.render(this.dom,a),this.Dom=a,L.getContainer().appendChild(a),a}},{key:"update",value:function(L){I.render(L,this.Dom)}}]),Z}(T.Control)},8515:function(ne,V,n){"use strict";n.r(V),n.d(V,{default:function(){return Le}});var b=n(2824),K=n(57663),$=n(71577),z=n(13062),X=n(71230),R=n(77883),I=n(49747),te=n(9715),S=n(903),Y=n(47673),w=n(4107),Z=n(402),N=n(61859),L=n(22385),a=n(45777),A=n(8403),J=n(1284),W=n(94184),Q=n.n(W),k=n(73935),B=n(25377),e=n(85893);function ae(m){var t=m.map,r=(0,B.tT)("tmap",function(l){var d=l.centerAndZoomMap,c=l.setMapState,i=l.toggleFull,p=l.isFull;return{centerAndZoomMap:d,setMapState:c,toggleFull:i,isFull:p}}),s=r.centerAndZoomMap,v=r.toggleFull,f=r.setMapState,o=r.isFull;return(0,e.jsxs)("div",{className:"tools",onClick:function(d){var c=d.target;!c||(oe.close(),q.close(),c.classList.contains("marker")?oe.open(t):c.classList.contains("distance")&&q.open(t))},children:[(0,e.jsx)(a.Z,{placement:"left",title:o?"\u9000\u51FA\u5168\u5C4F":"\u5168\u5C4F",color:A.wL.primaryColor,getPopupContainer:function(d){return document.getElementsByClassName("full-screen")[0]},children:(0,e.jsx)("div",{onClick:v,className:Q()("full-screen",o&&"exit-full"),children:o?"\u9000\u51FA\u5168\u5C4F":"\u5168\u5C4F"})}),(0,e.jsx)(a.Z,{placement:"left",title:"\u6DFB\u52A0\u6807\u8BB0",color:A.wL.primaryColor,getPopupContainer:function(d){return document.getElementsByClassName("marker")[0]},children:(0,e.jsx)("div",{className:"marker reset",children:"\u6DFB\u52A0\u6807\u8BB0"})}),(0,e.jsx)(a.Z,{placement:"left",title:"\u6D4B\u8DDD",color:A.wL.primaryColor,getPopupContainer:function(d){return document.getElementsByClassName("distance")[0]},children:(0,e.jsx)("div",{className:"distance reset",children:"\u6D4B\u8DDD"})}),(0,e.jsx)(a.Z,{placement:"left",title:"\u4EBA\u53E3\u70ED\u529B",color:A.wL.primaryColor,getPopupContainer:function(d){return document.getElementsByClassName("heatmap")[0]},children:(0,e.jsx)("div",{onClick:function(){return f(function(d){var c=d.heatmap;return{heatmap:!c}})},className:"heatmap reset",children:"\u4EBA\u53E3\u70ED\u529B"})}),(0,e.jsx)(a.Z,{placement:"left",title:"\u8FD4\u56DE\u9ED8\u8BA4\u5730\u56FE",color:A.wL.primaryColor,overlayInnerStyle:{marginRight:-1},getPopupContainer:function(d){return document.getElementsByClassName("reset")[0]},children:(0,e.jsx)("div",{onClick:function(){return s(void 0,0)},className:"reset",children:"\u8FD4\u56DE"})})]})}var q=function(){var m;return{open:function(r){var s={color:"red",showLabel:!0};m=new T.PolylineTool(r,s),m.open()},close:function(){var r;(r=m)===null||r===void 0||r.close()}}}(),oe=function(){var m,t=[],r;return{open:function(v){(!m||v!==r)&&(m=new T.MarkTool(r=v,{follow:!0}),m.addEventListener("mouseup",function(f){m.close(),document.onkeydown=null;var o=f.currentMarker;o.setZIndexOffset(J.QF.MARKER_TOOL);function l(){var d=o.getLngLat(),c=d.lng,i=d.lat,p=(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(N.Z.Title,{level:5,children:"\u6807\u8BB0\u70B9\u8BE6\u60C5"}),(0,e.jsxs)(S.Z,{onFinish:function(u){o.setLngLat(new T.LngLat(u.lng,u.lat)),O.closeInfoWindow()},onReset:function(){O.closeInfoWindow(),t.splice(t.indexOf(o),1),v.removeOverLay(o)},initialValues:{lng:c,lat:i,name},children:[(0,e.jsx)(S.Z.Item,{label:"\xA0\u540D\xA0\xA0\u79F0",name:"name",rules:[{max:255,message:"\u540D\u79F0\u957F\u5EA6\u4E0D\u8D85\u8FC7255"}],children:(0,e.jsx)(w.Z,{})}),(0,e.jsxs)(X.Z,{justify:"space-between",children:[(0,e.jsx)(S.Z.Item,{label:"\u7ECF\u5EA6",name:"lng",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7ECF\u5EA6"}],children:(0,e.jsx)(I.Z,{min:-180,max:180,step:1,precision:2,style:{width:100}})}),(0,e.jsx)(S.Z.Item,{label:"\u7EAC\u5EA6",name:"lat",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7EAC\u5EA6"}],children:(0,e.jsx)(I.Z,{min:-90,max:90,step:1,precision:2,style:{width:100}})})]}),(0,e.jsxs)("div",{style:{textAlign:"right"},children:[(0,e.jsx)($.Z,{htmlType:"reset",style:{marginRight:15},children:"\u5220\u9664"}),(0,e.jsx)($.Z,{htmlType:"submit",type:"primary",children:"\u786E\u5B9A"})]})]})]}),y=document.createElement("div");k.render(p,y);var O=new T.InfoWindow(y,{minWidth:380,minHeight:200});o.openInfoWindow(O)}l(),o.addEventListener("click",function(){l()}),t.push(o)})),m.open(),document.onkeydown=function(f){var o=f.keyCode;o===27&&m.close()}},close:function(){var v;(v=m)===null||v===void 0||v.close()}}}(),U=n(67294),Ze=n(34792),ve=n(48086),ce=n(56985),le=n(55121),me=n(8527),ee=n(68798);function fe(){var m=document.createElement("canvas");return!!(m.getContext&&m.getContext("2d"))}var pe=function(t,r){if(!!fe()){var s=new T.HeatmapOverlay({radius:20,gradient:{0:"rgb(0,0,0)",.15:"rgb(0,0,125)",.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"}});t.addOverLay(s);var v=r.reduce(function(f,o){return Math.max(f,o.count)},0);return s.setDataSet({data:r,max:v/2}),s}},he=function(t,r){var s=0,v=0;for(var f in r)s=Math.max(s,r[f].count),v=Math.min(v,r[f].count);var o=Number.MAX_VALUE,l=Number.MAX_VALUE,d=r.sort(function(h,u){return h.lng-u.lng});d.reduce(function(h,u){return u.lng-h.lng>.001&&(o=Math.min(o,u.lng-h.lng)),u},d[0]),d=r.sort(function(h,u){return h.lat-u.lat}),d.reduce(function(h,u){return u.lat-h.lat>.001&&(l=Math.min(l,u.lat-h.lat)),u},d[0]);var c=[],i=Math.max(10,Math.min(100,Math.floor(s/100))),p=Array(i).fill(0).map(function(){return Math.random()-.5}),y=s-v;r.forEach(function(h,u){for(var M=Math.floor(h.count*i/y),C=0;C<M;C++)c.push(new T.LngLat(p[C*u%i]*o+h.lng,p[(i-C)*u%i]*l+h.lat))});var O=new T.CloudMarkerCollection(c,{color:"#FF825F",ShapeType:TDT_POINT_SHAPE_CIRCLE,SizeType:TDT_POINT_SIZE_TINY});return t.addControl(O),O};function ge(m){var t=m.map,r=(0,B.tT)("tmap",function(f){var o=f.mapState,l=f.setMapState;return{setMapState:l,mapState:o}}),s=r.mapState,v=r.setMapState;(0,me.Z)(function(){if(!(!t||!s.heatmap)){var f=JSON.parse(ee.um.heatmap||"[]");if(f.length===0){ve.ZP.info("\u6682\u65E0\u4EBA\u53E3\u70ED\u529B\u6570\u636E\uFF01"),v(function(d){var c=d.heatmap;return{heatmap:!c}});return}var o=pe(t,f),l=new le.D((0,e.jsx)("div",{className:"static-legend",style:{width:128},children:(0,e.jsx)(ce.l,{})}),{className:ce.j});return t.addControl(l),l.setPosition(T_ANCHOR_BOTTOM_LEFT),l.setOffset(new T.Point(16,16)),t.addOverLay(o),function(){t.removeOverLay(o),t.removeControl(l)}}},[t,s.heatmap,ee.um.heatmap],{wait:500})}var ie=n(86582),je=n(98858),_=n(4914),ye=n(19818),se=n.n(ye);function Ee(m,t,r){var s="rgb(245,243,240)",v=se().get(m).value,f=se().get(t||s).value,o=(0,b.Z)(v,4),l=o[0],d=o[1],c=o[2],i=o[3],p=(0,b.Z)(f,3),y=p[0],O=p[1],h=p[2],u=1-(r||i),M=l-(l-y)*u,C=d-(d-O)*u,D=c-(c-h)*u,j=1;return se().to.rgb([M,C,D,j])}var Ce=function(t,r){var s=r.latitude,v=r.longitude,f=r.irregulars,o=f===void 0?[]:f,l=r.thresholdIntensity,d=l===void 0?0:l,c=r.thermodyNamic,i=c===void 0?"[]":c,p=o.filter(function(g){var E=g.intensity;return E>=d}),y=[],O=[],h=new T.LngLat(v,s),u=p[p.length-1].intensity,M=[];p.forEach(function(g){var E=g.intensity,x=g.points;E===u&&(M=M.concat(x.map(function(P){var H=P.longitude,G=P.latitude;return new T.LngLat(H,G)})))});var C=new T.Circle(h,1460,{color:"black",weight:1,opacity:.6,fillColor:"#ff0",enableMassClear:!1});y.push(C),(0,ie.Z)(p).reverse().forEach(function(g){var E=g.color,x=g.points,P=g.intensity,H=new T.Polygon(x.map(function(de){var be=de.longitude,De=de.latitude;return new T.LngLat(be,De)}),{color:"blue",weight:1,opacity:.2,fillColor:E,fillOpacity:.2});y.push(H);var G=x[Math.floor(x.length/2)],Oe=G.longitude,xe=G.latitude,Ae=new T.Label({text:"".concat(P,"\u5EA6\u533A"),position:new T.LngLat(Oe,xe),offset:new T.Point(0,0)});y.push(Ae)});var D=he(t,JSON.parse(i));O.push(D);var j=[],F=p.reduce(function(g,E){return g.every(function(x){return x.intensity!==E.intensity})&&g.push({intensity:E.intensity,color:E.color}),g},[]),re=(0,ie.Z)(F).reverse().reduce(function(g,E){var x=E.color,P=Ee(x,g[g.length-1],.2);return g.push(P),g},[]).reverse(),ue=new le.D((0,e.jsx)("div",{className:"static-legend intensity-legend",style:{width:128},children:(0,e.jsxs)(_.Z,{title:(0,e.jsx)("div",{className:"legend-title",children:"\u56FE\u4F8B"}),colon:!1,className:"legend-info",column:1,children:[F.map(function(g,E){var x=g.intensity,P=g.color;return(0,e.jsx)(_.Z.Item,{label:(0,e.jsx)("div",{className:"legend-block",style:{backgroundColor:re[E],height:12,top:5}}),children:"".concat(x,"\u5EA6\u533A")},x)}),(0,e.jsx)(_.Z.Item,{label:(0,e.jsx)("div",{className:"legend-defects"}),children:"\u65AD\u88C2\u5E26"}),(0,e.jsx)(_.Z.Item,{label:(0,e.jsx)("div",{className:"legend-epicenter"}),children:"\u9707\u4E2D"})]})}),{});return j.push([ue,{position:T_ANCHOR_BOTTOM_LEFT,offset:new T.Point(16,60)}]),y.forEach(function(g){var E;return((E=g.isVisible)===null||E===void 0?void 0:E.call(g))||t.addOverLay(g)}),j.forEach(function(g){var E=(0,b.Z)(g,2),x=E[0],P=E[1],H=P.position,G=P.offset;t.addControl(x),x.setOffset(G),x.setPosition(H)}),{points:M,cleaner:function(){y.forEach(function(E){return t.removeOverLay(E)}),j.forEach(function(E){var x=(0,b.Z)(E,2),P=x[0],H=x[1];return t.removeControl(P)}),O.forEach(function(E){return t.removeControl(E)})}}},Me=function(t,r){var s=r.flashflood,v=s.boundary,f=s.stream,o=[],l=new T.LngLat(r==null?void 0:r.longitude,r==null?void 0:r.latitude),d=v.split(",").map(function(u){var M=u.split(" ").map(function(F){return Number(F)}),C=(0,b.Z)(M,2),D=C[0],j=C[1];return new T.LngLat(D,j)}),c=new T.Polygon(d,{color:"rgb(22,137,239)",weight:1,opacity:.7,fillColor:"rgb(22,137,239)",fillOpacity:.7});o.push(c);var i=[],p=new T.Polyline(f.split(",").map(function(u){var M=u.split(" ").map(function(F){return Number(F)}),C=(0,b.Z)(M,2),D=C[0],j=C[1];return new T.LngLat(D,j)}),{color:"#FFF04D",weight:2,opacity:1});o.push(p);var y=new T.Circle(l,60,{color:"black",weight:1,opacity:1,fillColor:"#FF6609",fillOpacity:1});o.push(y);var O=function(){y.setRadius(Math.pow(2,18-t.getZoom())*5),console.log(Math.pow(2,18-t.getZoom())*5,t.getZoom())},h=new le.D((0,e.jsx)("div",{className:"static-legend flashflood",style:{width:128},children:(0,e.jsxs)("div",{className:"intensity-legend",children:[(0,e.jsx)("div",{className:"legend-title",children:"\u56FE\u4F8B"}),(0,e.jsxs)(_.Z,{colon:!1,className:"legend-info",column:1,children:[(0,e.jsx)(_.Z.Item,{label:(0,e.jsx)("div",{className:"legend-block",style:{backgroundColor:"rgba(22,137,239,.7)",height:12}}),children:"\u96C6\u6C34\u9762"}),(0,e.jsx)(_.Z.Item,{label:(0,e.jsx)("div",{className:"legend-defects"}),children:"\u6C47\u6C34\u8DEF\u5F84"}),(0,e.jsx)(_.Z.Item,{label:(0,e.jsx)("div",{className:"legend-epicenter"}),children:"\u503E\u6CFB\u70B9"})]})]})}),{});return i.push([h,{position:T_ANCHOR_BOTTOM_LEFT,offset:new T.Point(16,0)}]),o.forEach(function(u){return t.addOverLay(u)}),i.forEach(function(u){var M=(0,b.Z)(u,2),C=M[0],D=M[1],j=D.position,F=D.offset;t.addControl(C),C.setPosition(j),C.setOffset(F)}),{points:d,cleaner:function(){o.forEach(function(M){return t.removeOverLay(M)}),i.forEach(function(M){var C=(0,b.Z)(M,2),D=C[0],j=C[1];return t.removeControl(D)})}}};function Te(m){var t=m.map,r=(0,U.useState)(void 0),s=(0,b.Z)(r,2),v=s[0],f=s[1],o=(0,B.tT)("tmap",function(i){var p=i.mapViewPointFuncRef,y=i.centerAndZoomMap;return{mapViewPointFuncRef:p,centerAndZoomMap:y}}),l=o.mapViewPointFuncRef,d=o.centerAndZoomMap,c=(0,U.useMemo)(function(){switch(v){case A.tw.INTENSITY:return ee.Wl;case A.tw.FLASHFLOOD:return ee.d$;default:return ee.um}},[v]);return(0,U.useEffect)(function(){if(!(!t||!v||!c)){var i={},p=new T.LngLat(c==null?void 0:c.longitude,c==null?void 0:c.latitude),y=[];if(v===A.tw.INTENSITY)i=Ce(t,c);else if(v===A.tw.FLASHFLOOD)i=Me(t,c);else{var O=new T.Marker(p);O.setZIndexOffset(9),t.addOverLay(O),i.points=[p],i.cleaner=function(){return t.removeOverLay(O)}}return i.points&&y.push.apply(y,(0,ie.Z)(i.points)),y.length>1?l.current=function(){return t.setViewport(y)}:l.current=function(){return t.setViewport(y)},d(),function(){var h,u;(h=(u=i).cleaner)===null||h===void 0||h.call(u),l.current=void 0}}},[v,c,t]),(0,e.jsxs)("div",{className:"disaster-tools",children:[(0,e.jsx)("div",{className:"item",onClick:function(){f(void 0),d()},children:"\u6E05\u7A7A"}),(0,e.jsx)("div",{className:"item",onClick:function(){return f(A.tw.INTENSITY)},children:"\u70C8\u5EA6\u901F\u62A5"}),(0,e.jsx)("div",{className:"item",onClick:function(){return f(A.tw.FLASHFLOOD)},children:"\u5C71\u6D2A"}),(0,e.jsx)("div",{className:"item",onClick:function(){return f(A.tw.FIRE)},children:"\u5176\u4ED6"})]})}function Le(){var m,t=(0,U.useState)(),r=(0,b.Z)(t,2),s=r[0],v=r[1],f=(0,B.tT)("@@initialState"),o=f.initialState,l=(0,U.useRef)(),d=(0,B.tT)("tmap",function(i){var p=i.centerAndZoomMap;return{centerAndZoomMap:p}}),c=d.centerAndZoomMap;return ge({map:s}),(0,U.useEffect)(function(){if(!s){var i="http://t0.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=img&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=1cdc7e840fd7b63469e908f9bfd811f7",p=new T.TileLayer(i,{minZoom:1,maxZoom:18}),y=new T.Map("map",{layers:p});y.centerAndZoom(new T.LngLat(102.54,30.05),12),v(y)}},[]),(0,U.useEffect)(function(){var i;if(!!s){var p=o==null||(i=o.serveArea)===null||i===void 0?void 0:i.polygons,y="white",O=[],h=[];p.forEach(function(M,C){var D=M.map(function(F){var re=(0,b.Z)(F,2),ue=re[0],g=re[1];return new T.LngLat(ue,g)}),j=new T.Polyline(D,{weight:3,fillColor:"rgba(60,151,255,0.15)",color:y});O.push(j),h=h.concat(D)});var u=O.map(function(M){var C=new T.Polygon(M.getLngLats(),{strokeColor:"white",fillColor:"rgba(60,151,255,0.15)",strokeWeight:4,fillOpacity:.25,strokeOpacity:.5});return s.addOverLay(C),C});return l.current||(l.current=function(){s.setViewport(h),s.setZoom(7)},c(l)),function(){u.map(function(M){return s.removeOverLay(M)})}}},[s,o==null||(m=o.serveArea)===null||m===void 0?void 0:m.polygons]),(0,e.jsxs)("div",{className:"wrapper",children:[(0,e.jsx)("div",{id:"map",style:{width:"100%",height:"850px"}}),(0,e.jsx)(ae,{map:s}),(0,e.jsx)(Te,{map:s})]})}}}]);
