(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[54],{66671:function(ne){ne.exports={legend:"legend___2yfND"}},56985:function(ne,U,n){"use strict";n.d(U,{j:function(){return B},l:function(){return $}});var D=n(98858),K=n(4914),S=n(11849),Y=n(66671),z=n.n(Y),_=n(85893),B=z().legend,te=[{value:1,label:"\u9AD8",color:"#ff0404"},{value:2,label:"\u4E2D",color:"rgb(227,255,55)"},{value:3,label:"\u4F4E",color:"rgb(105,245,84)"},{value:4,label:"\u6781\u4F4E",color:"rgb(125,140,235)"},{value:5,label:"\u65E0",color:"#071533"}],$=function(){return(0,_.jsx)(K.Z,{colon:!1,className:"heatmap",column:1,title:(0,_.jsx)("div",{className:"legend-title",children:"\u4EBA\u53E3\u5BC6\u5EA6\u56FE\u4F8B"}),children:te.map(function(I){var j=I.color,b=I.value,L=I.label;return(0,_.jsx)(K.Z.Item,{label:(0,_.jsx)("div",{className:"legend-block",style:(0,S.Z)({backgroundColor:j,height:12,top:5,width:12,borderRadius:"50%"},b===5?{border:"1px solid #3C3C3C"}:{})}),children:L},b)})})}},55121:function(ne,U,n){"use strict";n.d(U,{X:function(){return te},D:function(){return $}});var D=n(69610),K=n(54941),S=n(81306),Y=n(6298),z=n(94184),_=n.n(z),B=n(73935),te=function(X){(0,S.Z)(j,X);var I=(0,Y.Z)(j);function j(b,L){var l,O=L.anchor,J=O===void 0?BMAP_ANCHOR_BOTTOM_LEFT:O,V=L.offset,Q=V===void 0?new BMapGL.Size(10,10):V,k=L.border,w=k===void 0?!0:k,e=L.center,ae=e===void 0?!1:e,q=L.className,oe=q===void 0?"":q;return(0,D.Z)(this,j),l=I.call(this),l.dom=void 0,l.Dom=null,l.border=void 0,l.center=void 0,l.className=void 0,l.defaultAnchor=J,l.defaultOffset=Q,l.dom=b,l.border=w,l.center=ae,l.className=oe,l}return(0,K.Z)(j,[{key:"initialize",value:function(L){var l=document.createElement("div");return l.className=_()(this.border&&"dom-control",this.center&&"control-center",this.className),B.render(this.dom,l),this.Dom=l,L.getContainer().appendChild(l),l}},{key:"update",value:function(L){B.render(L,this.Dom)}}]),j}(BMapGL.Control),$=function(X){(0,S.Z)(j,X);var I=(0,Y.Z)(j);function j(b,L){var l,O=L.border,J=O===void 0?!0:O,V=L.center,Q=V===void 0?!1:V,k=L.className,w=k===void 0?"":k;return(0,D.Z)(this,j),l=I.call(this),l.dom=void 0,l.Dom=null,l.border=void 0,l.center=void 0,l.className=void 0,l.dom=b,l.border=J,l.center=Q,l.className=w,l}return(0,K.Z)(j,[{key:"onAdd",value:function(L){var l=document.createElement("div");return l.className=_()(this.border&&"dom-control",this.center&&"control-center",this.className),B.render(this.dom,l),this.Dom=l,L.getContainer().appendChild(l),l}},{key:"update",value:function(L){B.render(L,this.Dom)}}]),j}(T.Control)},71349:function(ne,U,n){"use strict";n.r(U),n.d(U,{default:function(){return Ae}});var D=n(2824),K=n(57663),S=n(71577),Y=n(13062),z=n(71230),_=n(77883),B=n(49747),te=n(9715),$=n(903),X=n(47673),I=n(4107),j=n(402),b=n(61859),L=n(22385),l=n(45777),O=n(8403),J=n(1284),V=n(94184),Q=n.n(V),k=n(73935),w=n(25377),e=n(85893);function ae(m){var o=m.map,r=(0,w.tT)("tmap",function(a){var d=a.centerAndZoomMap,s=a.setMapState,u=a.toggleFull,p=a.isFull;return{centerAndZoomMap:d,setMapState:s,toggleFull:u,isFull:p}}),i=r.centerAndZoomMap,v=r.toggleFull,f=r.setMapState,t=r.isFull;return(0,e.jsxs)("div",{className:"tools",onClick:function(d){var s=d.target;!s||(oe.close(),q.close(),s.classList.contains("marker")?oe.open(o):s.classList.contains("distance")&&q.open(o))},children:[(0,e.jsx)(l.Z,{placement:"left",title:t?"\u9000\u51FA\u5168\u5C4F":"\u5168\u5C4F",color:O.wL.primaryColor,getPopupContainer:function(d){return document.getElementsByClassName("full-screen")[0]},children:(0,e.jsx)("div",{onClick:v,className:Q()("full-screen",t&&"exit-full"),children:t?"\u9000\u51FA\u5168\u5C4F":"\u5168\u5C4F"})}),(0,e.jsx)(l.Z,{placement:"left",title:"\u6DFB\u52A0\u6807\u8BB0",color:O.wL.primaryColor,getPopupContainer:function(d){return document.getElementsByClassName("marker")[0]},children:(0,e.jsx)("div",{className:"marker reset",children:"\u6DFB\u52A0\u6807\u8BB0"})}),(0,e.jsx)(l.Z,{placement:"left",title:"\u6D4B\u8DDD",color:O.wL.primaryColor,getPopupContainer:function(d){return document.getElementsByClassName("distance")[0]},children:(0,e.jsx)("div",{className:"distance reset",children:"\u6D4B\u8DDD"})}),(0,e.jsx)(l.Z,{placement:"left",title:"\u4EBA\u53E3\u70ED\u529B",color:O.wL.primaryColor,getPopupContainer:function(d){return document.getElementsByClassName("heatmap")[0]},children:(0,e.jsx)("div",{onClick:function(){return f(function(d){var s=d.heatmap;return{heatmap:!s}})},className:"heatmap reset",children:"\u4EBA\u53E3\u70ED\u529B"})}),(0,e.jsx)(l.Z,{placement:"left",title:"\u8FD4\u56DE\u9ED8\u8BA4\u5730\u56FE",color:O.wL.primaryColor,overlayInnerStyle:{marginRight:-1},getPopupContainer:function(d){return document.getElementsByClassName("reset")[0]},children:(0,e.jsx)("div",{onClick:function(){return i(void 0,0)},className:"reset",children:"\u8FD4\u56DE"})})]})}var q=function(){var m;return{open:function(r){var i={color:"red",showLabel:!0};m=new T.PolylineTool(r,i),m.open()},close:function(){var r;(r=m)===null||r===void 0||r.close()}}}(),oe=function(){var m,o=[],r;return{open:function(v){(!m||v!==r)&&(m=new T.MarkTool(r=v,{follow:!0}),m.addEventListener("mouseup",function(f){m.close(),document.onkeydown=null;var t=f.currentMarker;t.setZIndexOffset(J.QF.MARKER_TOOL);function a(){var d=t.getLngLat(),s=d.lng,u=d.lat,p=(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(b.Z.Title,{level:5,children:"\u6807\u8BB0\u70B9\u8BE6\u60C5"}),(0,e.jsxs)($.Z,{onFinish:function(c){t.setLngLat(new T.LngLat(c.lng,c.lat)),x.closeInfoWindow()},onReset:function(){x.closeInfoWindow(),o.splice(o.indexOf(t),1),v.removeOverLay(t)},initialValues:{lng:s,lat:u,name},children:[(0,e.jsx)($.Z.Item,{label:"\xA0\u540D\xA0\xA0\u79F0",name:"name",rules:[{max:255,message:"\u540D\u79F0\u957F\u5EA6\u4E0D\u8D85\u8FC7255"}],children:(0,e.jsx)(I.Z,{})}),(0,e.jsxs)(z.Z,{justify:"space-between",children:[(0,e.jsx)($.Z.Item,{label:"\u7ECF\u5EA6",name:"lng",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7ECF\u5EA6"}],children:(0,e.jsx)(B.Z,{min:-180,max:180,step:1,precision:2,style:{width:100}})}),(0,e.jsx)($.Z.Item,{label:"\u7EAC\u5EA6",name:"lat",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7EAC\u5EA6"}],children:(0,e.jsx)(B.Z,{min:-90,max:90,step:1,precision:2,style:{width:100}})})]}),(0,e.jsxs)("div",{style:{textAlign:"right"},children:[(0,e.jsx)(S.Z,{htmlType:"reset",style:{marginRight:15},children:"\u5220\u9664"}),(0,e.jsx)(S.Z,{htmlType:"submit",type:"primary",children:"\u786E\u5B9A"})]})]})]}),y=document.createElement("div");k.render(p,y);var x=new T.InfoWindow(y,{minWidth:380,minHeight:200});t.openInfoWindow(x)}a(),t.addEventListener("click",function(){a()}),o.push(t)})),m.open(),document.onkeydown=function(f){var t=f.keyCode;t===27&&m.close()}},close:function(){var v;(v=m)===null||v===void 0||v.close()}}}(),R=n(67294),be=n(34792),ve=n(48086),ce=n(56985),le=n(55121),me=n(70902),ee=n(25859);function fe(){var m=document.createElement("canvas");return!!(m.getContext&&m.getContext("2d"))}var pe=function(o,r){if(!!fe()){var i=new T.HeatmapOverlay({radius:20,gradient:{0:"rgb(0,0,0)",.15:"rgb(0,0,125)",.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"}});o.addOverLay(i);var v=r.reduce(function(f,t){return Math.max(f,t.count)},0);return i.setDataSet({data:r,max:v/2}),i}},he=function(o,r){var i=0,v=0;for(var f in r)i=Math.max(i,r[f].count),v=Math.min(v,r[f].count);var t=Number.MAX_VALUE,a=Number.MAX_VALUE,d=r.sort(function(h,c){return h.lng-c.lng});d.reduce(function(h,c){return c.lng-h.lng>.001&&(t=Math.min(t,c.lng-h.lng)),c},d[0]),d=r.sort(function(h,c){return h.lat-c.lat}),d.reduce(function(h,c){return c.lat-h.lat>.001&&(a=Math.min(a,c.lat-h.lat)),c},d[0]);var s=[],u=Math.max(10,Math.min(100,Math.floor(i/100))),p=Array(u).fill(0).map(function(){return Math.random()-.5}),y=i-v;r.forEach(function(h,c){for(var M=Math.floor(h.count*u/y),C=0;C<M;C++)s.push(new T.LngLat(p[C*c%u]*t+h.lng,p[(u-C)*c%u]*a+h.lat))});var x=new T.CloudMarkerCollection(s,{color:"#FF825F",ShapeType:TDT_POINT_SHAPE_CIRCLE,SizeType:TDT_POINT_SIZE_TINY});return o.addControl(x),x};function ge(m){var o=m.map,r=(0,w.tT)("tmap",function(f){var t=f.mapState,a=f.setMapState;return{setMapState:a,mapState:t}}),i=r.mapState,v=r.setMapState;(0,me.Z)(function(){if(!(!o||!i.heatmap)){var f=JSON.parse(ee.um.heatmap||"[]");if(f.length===0){ve.ZP.info("\u6682\u65E0\u4EBA\u53E3\u70ED\u529B\u6570\u636E\uFF01"),v(function(d){var s=d.heatmap;return{heatmap:!s}});return}var t=pe(o,f),a=new le.D((0,e.jsx)("div",{className:"static-legend",style:{width:128},children:(0,e.jsx)(ce.l,{})}),{className:ce.j});return o.addControl(a),a.setPosition(T_ANCHOR_BOTTOM_LEFT),a.setOffset(new T.Point(16,16)),o.addOverLay(t),function(){o.removeOverLay(t),o.removeControl(a)}}},[o,i.heatmap,ee.um.heatmap],{wait:500})}var ie=n(86582),Pe=n(98858),W=n(4914),ye=n(19818),se=n.n(ye);function Ee(m,o,r){var i="rgb(245,243,240)",v=se().get(m).value,f=se().get(o||i).value,t=(0,D.Z)(v,4),a=t[0],d=t[1],s=t[2],u=t[3],p=(0,D.Z)(f,3),y=p[0],x=p[1],h=p[2],c=1-(r||u),M=a-(a-y)*c,C=d-(d-x)*c,Z=s-(s-h)*c,N=1;return se().to.rgb([M,C,Z,N])}var Ce=function(o,r){var i=r.latitude,v=r.longitude,f=r.irregulars,t=f===void 0?[]:f,a=r.thresholdIntensity,d=a===void 0?0:a,s=r.thermodyNamic,u=s===void 0?"[]":s,p=t.filter(function(g){var E=g.intensity;return E>=d}),y=[],x=[],h=new T.LngLat(v,i),c=p[p.length-1].intensity,M=[];p.forEach(function(g){var E=g.intensity,A=g.points;E===c&&(M=M.concat(A.map(function(P){var H=P.longitude,G=P.latitude;return new T.LngLat(H,G)})))});var C=new T.Circle(h,1460,{color:"black",weight:1,opacity:.6,fillColor:"#ff0",enableMassClear:!1});y.push(C),(0,ie.Z)(p).reverse().forEach(function(g){var E=g.color,A=g.points,P=g.intensity,H=new T.Polygon(A.map(function(de){var je=de.longitude,Ne=de.latitude;return new T.LngLat(je,Ne)}),{color:"blue",weight:1,opacity:.2,fillColor:E,fillOpacity:.2});y.push(H);var G=A[Math.floor(A.length/2)],Oe=G.longitude,De=G.latitude,Ze=new T.Label({text:"".concat(P,"\u5EA6\u533A"),position:new T.LngLat(Oe,De),offset:new T.Point(0,0)});y.push(Ze)});var Z=he(o,JSON.parse(u));x.push(Z);var N=[],F=p.reduce(function(g,E){return g.every(function(A){return A.intensity!==E.intensity})&&g.push({intensity:E.intensity,color:E.color}),g},[]),re=(0,ie.Z)(F).reverse().reduce(function(g,E){var A=E.color,P=Ee(A,g[g.length-1],.2);return g.push(P),g},[]).reverse(),ue=new le.D((0,e.jsx)("div",{className:"static-legend intensity-legend",style:{width:128},children:(0,e.jsxs)(W.Z,{title:(0,e.jsx)("div",{className:"legend-title",children:"\u56FE\u4F8B"}),colon:!1,className:"legend-info",column:1,children:[F.map(function(g,E){var A=g.intensity,P=g.color;return(0,e.jsx)(W.Z.Item,{label:(0,e.jsx)("div",{className:"legend-block",style:{backgroundColor:re[E],height:12,top:5}}),children:"".concat(A,"\u5EA6\u533A")},A)}),(0,e.jsx)(W.Z.Item,{label:(0,e.jsx)("div",{className:"legend-defects"}),children:"\u65AD\u88C2\u5E26"}),(0,e.jsx)(W.Z.Item,{label:(0,e.jsx)("div",{className:"legend-epicenter"}),children:"\u9707\u4E2D"})]})}),{});return N.push([ue,{position:T_ANCHOR_BOTTOM_LEFT,offset:new T.Point(16,60)}]),y.forEach(function(g){var E;return((E=g.isVisible)===null||E===void 0?void 0:E.call(g))||o.addOverLay(g)}),N.forEach(function(g){var E=(0,D.Z)(g,2),A=E[0],P=E[1],H=P.position,G=P.offset;o.addControl(A),A.setOffset(G),A.setPosition(H)}),{points:M,cleaner:function(){y.forEach(function(E){return o.removeOverLay(E)}),N.forEach(function(E){var A=(0,D.Z)(E,2),P=A[0],H=A[1];return o.removeControl(P)}),x.forEach(function(E){return o.removeControl(E)})}}},Te=function(o,r){var i=r.flashflood,v=i.boundary,f=i.stream,t=[],a=new T.LngLat(r==null?void 0:r.longitude,r==null?void 0:r.latitude),d=v.split(",").map(function(c){var M=c.split(" ").map(function(F){return Number(F)}),C=(0,D.Z)(M,2),Z=C[0],N=C[1];return new T.LngLat(Z,N)}),s=new T.Polygon(d,{color:"rgb(22,137,239)",weight:1,opacity:.7,fillColor:"rgb(22,137,239)",fillOpacity:.7});t.push(s);var u=[],p=new T.Polyline(f.split(",").map(function(c){var M=c.split(" ").map(function(F){return Number(F)}),C=(0,D.Z)(M,2),Z=C[0],N=C[1];return new T.LngLat(Z,N)}),{color:"#FFF04D",weight:2,opacity:1});t.push(p);var y=new T.Circle(a,60,{color:"black",weight:1,opacity:1,fillColor:"#FF6609",fillOpacity:1});t.push(y);var x=function(){y.setRadius(Math.pow(2,18-o.getZoom())*5),console.log(Math.pow(2,18-o.getZoom())*5,o.getZoom())},h=new le.D((0,e.jsx)("div",{className:"static-legend flashflood",style:{width:128},children:(0,e.jsxs)("div",{className:"intensity-legend",children:[(0,e.jsx)("div",{className:"legend-title",children:"\u56FE\u4F8B"}),(0,e.jsxs)(W.Z,{colon:!1,className:"legend-info",column:1,children:[(0,e.jsx)(W.Z.Item,{label:(0,e.jsx)("div",{className:"legend-block",style:{backgroundColor:"rgba(22,137,239,.7)",height:12}}),children:"\u96C6\u6C34\u9762"}),(0,e.jsx)(W.Z.Item,{label:(0,e.jsx)("div",{className:"legend-defects"}),children:"\u6C47\u6C34\u8DEF\u5F84"}),(0,e.jsx)(W.Z.Item,{label:(0,e.jsx)("div",{className:"legend-epicenter"}),children:"\u503E\u6CFB\u70B9"})]})]})}),{});return u.push([h,{position:T_ANCHOR_BOTTOM_LEFT,offset:new T.Point(16,60)}]),t.forEach(function(c){return o.addOverLay(c)}),u.forEach(function(c){var M=(0,D.Z)(c,2),C=M[0],Z=M[1],N=Z.position,F=Z.offset;o.addControl(C),C.setPosition(N),C.setOffset(F)}),{points:d,cleaner:function(){t.forEach(function(M){return o.removeOverLay(M)}),u.forEach(function(M){var C=(0,D.Z)(M,2),Z=C[0],N=C[1];return o.removeControl(Z)})}}};function Me(m){var o=m.map,r=(0,R.useState)(void 0),i=(0,D.Z)(r,2),v=i[0],f=i[1],t=(0,w.tT)("tmap",function(u){var p=u.mapViewPointFuncRef,y=u.centerAndZoomMap;return{mapViewPointFuncRef:p,centerAndZoomMap:y}}),a=t.mapViewPointFuncRef,d=t.centerAndZoomMap,s=(0,R.useMemo)(function(){switch(v){case O.tw.INTENSITY:return ee.Wl;case O.tw.FLASHFLOOD:return ee.d$;default:return ee.um}},[v]);return(0,R.useEffect)(function(){if(!(!o||!v||!s)){var u={},p=new T.LngLat(s==null?void 0:s.longitude,s==null?void 0:s.latitude),y=[];if(v===O.tw.INTENSITY)u=Ce(o,s);else if(v===O.tw.FLASHFLOOD)u=Te(o,s);else{var x=new T.Marker(p);x.setZIndexOffset(9),o.addOverLay(x),u.points=[p],u.cleaner=function(){return o.removeOverLay(x)}}return u.points&&y.push.apply(y,(0,ie.Z)(u.points)),y.length>1?a.current=function(){return o.setViewport(y)}:a.current=function(){return o.setViewport(y)},d(),function(){var h,c;(h=(c=u).cleaner)===null||h===void 0||h.call(c),a.current=void 0}}},[v,s,o]),(0,e.jsxs)("div",{className:"disaster-tools",children:[(0,e.jsx)("div",{className:"item",onClick:function(){f(void 0),d()},children:"\u6E05\u7A7A"}),(0,e.jsx)("div",{className:"item",onClick:function(){return f(O.tw.INTENSITY)},children:"\u70C8\u5EA6\u901F\u62A5"}),(0,e.jsx)("div",{className:"item",onClick:function(){return f(O.tw.FLASHFLOOD)},children:"\u5C71\u6D2A"}),(0,e.jsx)("div",{className:"item",onClick:function(){return f(O.tw.FIRE)},children:"\u5176\u4ED6"})]})}var Le=n(58580);function xe(m){var o=m.map,r=(0,R.useState)(),i=(0,D.Z)(r,2),v=i[0],f=i[1],t=(0,Le.Z)(v,{wait:500}),a=(0,R.useCallback)(function(){if(!!t){var d=new T.AdministrativeDivision;d.search({searchWord:t,searchType:1,needSubInfo:!0,needAll:!0,needPre:!0,needPolygon:!0},function(s){console.log(s,s.getData())})}},[o,t]);return(0,e.jsxs)("div",{className:"boundarys",children:[(0,e.jsx)(I.Z,{value:v,onChange:function(s){return f(s.target.value)}}),(0,e.jsx)(S.Z,{type:"primary",onClick:a,children:"\u786E\u5B9A"})]})}function Ae(){var m,o=(0,R.useState)(),r=(0,D.Z)(o,2),i=r[0],v=r[1],f=(0,w.tT)("@@initialState"),t=f.initialState,a=(0,R.useRef)(),d=(0,w.tT)("tmap",function(u){var p=u.centerAndZoomMap;return{centerAndZoomMap:p}}),s=d.centerAndZoomMap;return ge({map:i}),(0,R.useEffect)(function(){if(!i){var u="http://t0.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=img&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=1cdc7e840fd7b63469e908f9bfd811f7",p=new T.TileLayer(u,{minZoom:1,maxZoom:18}),y=new T.Map("map",{layers:p});y.centerAndZoom(new T.LngLat(102.54,30.05),12),v(y)}},[]),(0,R.useEffect)(function(){var u;if(!!i){var p=t==null||(u=t.serveArea)===null||u===void 0?void 0:u.polygons,y="white",x=[],h=[];p.forEach(function(M,C){var Z=M.map(function(F){var re=(0,D.Z)(F,2),ue=re[0],g=re[1];return new T.LngLat(ue,g)}),N=new T.Polyline(Z,{weight:3,fillColor:"rgba(60,151,255,0.15)",color:y});x.push(N),h=h.concat(Z)});var c=x.map(function(M){var C=new T.Polygon(M.getLngLats(),{strokeColor:"white",fillColor:"rgba(60,151,255,0.15)",strokeWeight:4,fillOpacity:.25,strokeOpacity:.5});return i.addOverLay(C),C});return a.current||(a.current=function(){i.setViewport(h),i.setZoom(7)},s(a)),function(){c.map(function(M){return i.removeOverLay(M)})}}},[i,t==null||(m=t.serveArea)===null||m===void 0?void 0:m.polygons]),(0,e.jsxs)("div",{className:"wrapper",children:[(0,e.jsx)("div",{id:"map",style:{width:"100%",height:"850px"}}),(0,e.jsx)(xe,{map:i}),(0,e.jsx)(ae,{map:i}),(0,e.jsx)(Me,{map:i})]})}}}]);
