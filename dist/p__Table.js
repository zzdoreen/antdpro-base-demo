(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[310],{90813:function(U){U.exports={start:"start___3TT4V",loading:"loading___2O2h9",end:"end___34l8P"}},18778:function(U){U.exports={table:"table___3IxDk",modal:"modal___LVRzp",form:"form___zeDs-"}},97796:function(U){U.exports={_table:"_table___3odCR"}},52023:function(U,K,n){"use strict";n.r(K),n.d(K,{default:function(){return Ve}});var J=n(34792),L=n(48086),se=n(57663),A=n(71577),u=n(11849),b=n(2824),fe=n(13062),Q=n(71230),ve=n(89032),oe=n(15746),me=n(71194),_=n(50146),ee=n(32059),f=n(93224),he=n(86582),xe=n(76570),ge=n(49101),ie=n(90213),pe=n(94184),Ce=n.n(pe),ye=n(82492),te=n.n(ye),Fe=n(30381),B=n.n(Fe),v=n(67294),Se=n(18778),ue=n.n(Se),r=n(85893),Ze=["onSubmit","modal","setModal","hasRestFooter","refreshTime","modelProps","onCancel"],Pe=["searchSpan","extraActions","addText","addButtonProps","hideSearchButton","className","actionRef","setModal"],je={title:"\u5E8F\u53F7",valueType:"index",key:"index",width:100,render:function(i,o,h,x){var d=x.pageInfo;d=d===void 0?{}:d;var g=d.pageSize,p=g===void 0?0:g,S=d.current,Z=S===void 0?1:S;return(0,r.jsx)("div",{style:{padding:"5px 0"},children:Z*p+h+1-p})}};function Ae(t){var i=t.columns,o=t.request,h=t.showIndexColumn,x=h===void 0?!0:h,d=(0,v.useMemo)(function(){return(x?[je].concat((0,he.Z)(i)):i).map(function(e){return te()({align:e.valueType==="option"?"center":void 0,fieldProps:{allowClear:e.valueType!=="digit"?!0:void 0,placeholder:null},filters:void 0},e)})},[i]),g=(0,v.useRef)(),p=(0,v.useCallback)(function(e){var l;return(l=g.current)===null||l===void 0?void 0:l.reload(e)},[g]),S=(0,v.useState)({visible:!1}),Z=(0,b.Z)(S,2),s=Z[0],a=Z[1];return{setModal:a,modal:s,reload:p,proTableProps:{request:o,columns:d,setModal:a,actionRef:g,rowKey:"id"},proFormModalProps:{modal:s,setModal:a,columns:d}}}function Te(t){var i=t.onSubmit,o=t.modal,h=t.setModal,x=t.hasRestFooter,d=x===void 0?!1:x,g=t.refreshTime,p=g===void 0?{flag:!1,name:"createdAt"}:g,S=t.modelProps,Z=t.onCancel,s=Z===void 0?!1:Z,a=(0,f.Z)(t,Ze),e=(0,v.useRef)();(0,v.useEffect)(function(){var P=null,c=o.isAdd,F=o.visible,E=o.title;return(c||E==="\u5904\u7406")&&p.flag&&F&&(P=setInterval(function(){var N,O;return(N=e.current)===null||N===void 0?void 0:N.setFieldsValue((0,u.Z)((0,u.Z)({},(O=e.current)===null||O===void 0?void 0:O.getFieldsValue()),{},(0,ee.Z)({},p==null?void 0:p.name,B()())))},1e3)),function(){P&&clearInterval(P)}},[o.visible,o.isAdd,p,o.title]),(0,v.useEffect)(function(){h(function(P){return(0,u.Z)((0,u.Z)({},P),{},{isAdd:!o.defaultFormValues})})},[o.visible,o.defaultFormValues]),(0,v.useEffect)(function(){var P=o.visible,c=o.defaultFormValues;if(P){var F,E;(F=e.current)===null||F===void 0||F.resetFields(),c&&((E=e.current)===null||E===void 0||E.setFieldsValue(c))}},[o.visible,o.defaultFormValues]);var l=(0,v.useMemo)(function(){return te()({form:{layout:"horizontal"}},a)},[a]),m=(0,v.useState)(!1),C=(0,b.Z)(m,2),R=C[0],D=C[1];return(0,r.jsx)(_.Z,(0,u.Z)((0,u.Z)((0,u.Z)({visible:o.visible,title:o.title,className:ue().modal,onCancel:function(){var c,F;s&&s((c=e.current)===null||c===void 0?void 0:c.getFieldsValue()),(F=e.current)===null||F===void 0||F.setFieldsValue({file:[]}),h({visible:!1})},forceRender:!0,maskClosable:!1,onOk:function(){var c;return(c=e.current)===null||c===void 0?void 0:c.validateFields().then(function(F){return D(!0),i==null?void 0:i(F)}).finally(function(){return D(!1)})},okButtonProps:{loading:R}},d&&{footer:[(0,r.jsx)(A.Z,{onClick:function(){var c;return(c=e.current)===null||c===void 0?void 0:c.setFieldsValue((0,u.Z)((0,u.Z)({},o.defaultFormValues),{},{content:"",result:""}))},children:"\u91CD\u7F6E"}),(0,r.jsx)(A.Z,{type:"primary",onClick:function(){var c;return(c=e.current)===null||c===void 0?void 0:c.validateFields().then(function(F){return D(!0),i==null?void 0:i(F)}).finally(function(){return D(!1)})},children:"\u4FDD\u5B58"})]}),S),{},{children:(0,r.jsx)(ie.ZP,(0,u.Z)({type:"form",formRef:e},l))}))}function Ie(t){var i=t.searchSpan,o=i===void 0?6:i,h=t.extraActions,x=t.addText,d=t.addButtonProps,g=t.hideSearchButton,p=t.className,S=t.actionRef,Z=t.setModal,s=(0,f.Z)(t,Pe),a=te()({options:!1,toolBarRender:!1,actionRef:S,pagination:{size:"default",defaultPageSize:10,showSizeChanger:!0},className:Ce()(ue().table,p),search:{span:o,optionRender:function(l,m,C){return(0,r.jsxs)(Q.Z,{justify:"space-between",children:[g?(0,r.jsx)("span",{}):v.cloneElement(C[1],{icon:(0,r.jsx)(xe.Z,{})}),(0,r.jsxs)(oe.Z,{children:[x&&(0,r.jsx)(A.Z,(0,u.Z)((0,u.Z)({type:"primary",icon:(0,r.jsx)(ge.Z,{}),onClick:function(){return Z({visible:!0,title:x})}},d),{},{children:x})),t.extraActions]})]})}}},s);return(0,r.jsx)(ie.ZP,(0,u.Z)({},a))}var Re=n(42122),X=n(91156),w=n(17024),De=n(5966),Ee=n(97796),be=n.n(Ee),ze=n(20228),Be=n(11382),Ge=n(54421),ne=n(38272),ke=n(402),k=n(61859),We=n(43185),de=n(94412),Me=n(7085),W=n(51459),Le=n(90813),re=n.n(Le);function Ne(t){var i=t.template,o=t.service,h=t.name,x=t.reload,d=t.tootip,g=t.accept,p=g===void 0?".xls,.xlsx":g,S=t.validator,Z=(0,v.useState)(!1),s=(0,b.Z)(Z,2),a=s[0],e=s[1],l=(0,v.useState)(y.START),m=(0,b.Z)(l,2),C=m[0],R=m[1],D=(0,v.useState)({success:0,failed:[]}),P=(0,b.Z)(D,2),c=P[0],F=P[1],E=(0,v.useState)([]),N=(0,b.Z)(E,2),O=N[0],z=N[1],G=(0,v.useRef)(),ae=(0,v.useCallback)(function(I,$){return $&&!$(I)?de.Z.LIST_IGNORE:(G.current=I,!1)},[]),H=(0,v.useCallback)(function(){if(!G.current)return L.ZP.error("\u8BF7\u9009\u62E9\u6587\u4EF6\uFF01");R(y.LOADING),o(G.current).then(function(I){var $=I.code,le=I.data,Ue=I.message;if($!==0)throw Ue;F(le),R(y.END)}).catch(function(I){L.ZP.error(I||"\u5BFC\u5165\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),R(y.START)})},[]),V=(0,v.useCallback)(function(){C===y.END&&(x==null||x(!0)),R(y.START),z([]),G.current=void 0,e(!1)},[C]),M,j;if(C===y.START)M=(0,r.jsxs)(ne.ZP,{className:re().start,children:[(0,r.jsx)(Q.Z,{className:"title",children:"\u8BF7\u6309\u6A21\u677F\u6807\u51C6\u683C\u5F0F\u5BFC\u5165\u6570\u636E"}),(0,r.jsx)(Q.Z,{className:"template-link",children:(0,r.jsx)(k.Z.Link,{href:i,download:!0,children:"\u4E0B\u8F7D\u5BFC\u5165\u6A21\u677F"})}),(0,r.jsx)(de.Z,{beforeUpload:function($){return ae($,S)},accept:p,showUploadList:{showRemoveIcon:!1},fileList:O,onChange:function($){var le=$.fileList;return z(le.slice(-1))},children:(0,r.jsx)(A.Z,{type:"primary",ghost:!0,children:"\u9009\u62E9\u6587\u4EF6"})}),(0,r.jsx)("span",{className:"tooltip",children:d})]}),j=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A.Z,{onClick:V,children:"\u53D6\u6D88"}),(0,r.jsx)(A.Z,{onClick:H,type:"primary",children:"\u5BFC\u5165"})]});else if(C===y.LOADING)M=(0,r.jsx)(ne.ZP,{className:re().loading,children:(0,r.jsx)(Be.Z,{indicator:(0,r.jsx)(Me.Z,{style:{fontSize:40},spin:!0}),tip:"\u5BFC\u5165\u4E2D"})}),j=null;else{var T=c,Y=T.success,q=T.failed;M=(0,r.jsxs)(ne.ZP,{className:re().end,children:[(0,r.jsxs)(k.Z,{children:["\u5BFC\u5165\u5B8C\u6210\uFF0C\u5B8C\u6210",(0,r.jsx)(k.Z.Text,{style:{padding:"0 4px"},strong:!0,children:Y}),"\u6761\uFF0C\u5931\u8D25",(0,r.jsx)(k.Z.Text,{style:{padding:"0 4px"},strong:!0,type:q.length?"danger":void 0,children:q.length}),"\u6761"]}),q.length>0&&(0,r.jsx)(k.Z.Link,{onClick:function(){return Oe(q,h)},children:"\u4E0B\u8F7D\u5931\u8D25\u65E5\u5FD7"})]}),j=(0,r.jsx)(A.Z,{onClick:V,type:"primary",children:"\u786E\u5B9A"})}return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{onClick:function(){return e(!0)},children:t.children}),(0,r.jsx)(_.Z,{title:"\u5BFC\u5165".concat(h),visible:a,maskClosable:!1,footer:j,onCancel:V,children:M})]})}var y;(function(t){t[t.START=0]="START",t[t.LOADING=1]="LOADING",t[t.END=2]="END"})(y||(y={}));function Oe(t,i){var o=[["\u884C\u53F7","\u5931\u8D25\u539F\u56E0"]],h=W.utils.aoa_to_sheet(o),x=W.utils.sheet_add_aoa(h,t.map(function(g){var p=g.index,S=g.reason;return[p,S]}),{origin:"A2"}),d=W.utils.book_new();W.utils.book_append_sheet(d,x),(0,W.writeFile)(d,"".concat(i,"\u5BFC\u5165\u5931\u8D25\u65E5\u5FD7").concat(B()().format("YYYYMMDDHHmmss"),".xlsx"))}function He(t){var i=t.service,o=t.name,h=t.reload,x=t.tootip,d=t.accept,g=d===void 0?".xls,.xlsx":d,p=t.validator,S=useState(!1),Z=_slicedToArray(S,2),s=Z[0],a=Z[1],e=useState(y.START),l=_slicedToArray(e,2),m=l[0],C=l[1],R=useState(!1),D=_slicedToArray(R,2),P=D[0],c=D[1],F=useState([]),E=_slicedToArray(F,2),N=E[0],O=E[1],z=useRef(),G=useCallback(function(j,T){return T&&!T(j)?_Upload.LIST_IGNORE:(z.current=j,!1)},[]),ae=useCallback(function(){if(!z.current)return _message.error("\u8BF7\u9009\u62E9\u6587\u4EF6\uFF01");C(y.LOADING),i(z.current).then(function(j){var T=j.code,Y=j.message;if(c(T===0),T!==0)throw Y;C(y.END)}).catch(function(j){_message.error(j||"\u5BFC\u5165\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),C(y.START)})},[]),H=useCallback(function(){m===y.END&&(h==null||h()),C(y.START),O([]),z.current=void 0,a(!1)},[m]),V,M;return m===y.START?(V=_jsxs(_List,{className:style.start,children:[_jsx(_Upload,{beforeUpload:function(T){return G(T,p)},accept:g,fileList:N,onChange:function(T){var Y=T.fileList;return O(Y.slice(-1))},children:_jsx(_Button,{type:"primary",ghost:!0,children:"\u9009\u62E9\u6587\u4EF6"})}),_jsx("span",{className:"tooltip",children:x})]}),M=_jsxs(_Fragment,{children:[_jsx(_Button,{onClick:H,children:"\u53D6\u6D88"}),_jsx(_Button,{onClick:ae,type:"primary",children:"\u5BFC\u5165"})]})):m===y.LOADING?(V=_jsx(_List,{className:style.loading,children:_jsx(_Spin,{indicator:_jsx(LoadingOutlined,{style:{fontSize:40},spin:!0}),tip:"\u4E0A\u4F20\u4E2D"})}),M=null):(V=_jsx(_List,{className:style.end,children:_jsx(_Typography,{children:P?"\u4E0A\u4F20\u5B8C\u6210":"\u4E0A\u4F20\u5931\u8D25"})}),M=_jsx(_Button,{onClick:H,type:"primary",children:"\u786E\u5B9A"})),_jsxs(_Fragment,{children:[_jsx("span",{onClick:function(){return a(!0)},children:t.children}),_jsx(_Modal,{title:"\u4E0A\u4F20".concat(o),visible:s,maskClosable:!1,footer:M,onCancel:H,children:V})]})}var ce=n(8403);function Ve(){var t=(0,v.useMemo)(function(){return[{title:function(a,e){return e==="table"?"\u5B57\u7B26\u4E32":"\u540D\u5B57(\u5B57\u7B26\u4E32"},dataIndex:"name",formItemProps:{rules:[{required:!0},{max:30}]}},{title:"\u6570\u5B57",dataIndex:"age",valueType:"digitRange",formItemProps:{addonAfter:"\u5C81",addonBefore:"+"},fieldProps:{precision:2,min:0,max:120},search:{transform:function(a){if(!a)return{};var e=(0,b.Z)(a,2),l=e[0],m=e[1];return{minAge:l,maxAge:m}}},render:function(a,e){var l=e.age;return l}},{title:"\u7C7B\u522B",dataIndex:"eventType",valueEnum:(0,ce.KP)(ce.gM),fieldProps:{mode:"multiple",maxTagCount:"responsive"}},{title:"\u7B5B\u9009",dataIndex:"sex",valueEnum:new Map([["female","\u5973"],["male","\u7537"]])},{title:"\u65F6\u95F4",dataIndex:"time",valueType:"dateRange",hideInForm:!0,render:function(a,e){var l=e.time;return(0,w.Pj)(l)},search:{transform:function(a){if(!a)return{};var e=(0,b.Z)(a,2),l=e[0],m=e[1];return{createStartAt:B()(l).startOf("day").unix(),createEndAt:B()(m).endOf("day").unix()}}}},{title:"\u624B\u673A\u53F7",dataIndex:"phone",search:!1,renderText:w.eq,renderFormItem:function(a,e,l){return(0,r.jsx)($e,{form:l})}},{title:"\u56FE\u7247",dataIndex:"imgs",valueType:"image",search:!1,hideInForm:!0},{title:"\u5F00\u59CB\u65E5\u671F",dataIndex:"startAt",valueType:"date",search:!1,formItemProps:{rules:[{required:!0,message:"\u8BF7\u9009\u62E9${label}"}]},render:function(a,e){var l=e.startAt;return B().unix(l).format("yyyy-MM-DD")},fieldProps:{allowClear:!1,placeholder:"\u8BF7\u9009\u62E9"}},{title:"\u7ED3\u675F\u65E5\u671F",dataIndex:"endAt",valueType:"date",search:!1,formItemProps:function(a){return{rules:[{required:!0,message:"\u8BF7\u9009\u62E9${label}"},{validator:function(l,m){var C,R=a==null||(C=a.getFieldValue("startAt"))===null||C===void 0?void 0:C.startOf("day").unix(),D=m==null?void 0:m.startOf("day").unix();return D<R?Promise.reject("\u7ED3\u675F\u65E5\u671F\u4E0D\u80FD\u65E9\u4E8E\u5F00\u59CB\u65E5\u671F"):Promise.resolve()}}]}},fieldProps:function(a){var e;console.log(a==null?void 0:a.getFieldValue("startAt"));var l=a==null||(e=a.getFieldValue("startAt"))===null||e===void 0?void 0:e.startOf("day");return{allowClear:!1,placeholder:"\u8BF7\u9009\u62E9",disabledDate:function(C){return C<l}}},render:function(a,e){var l=e.endAt;return B().unix(l).format("yyyy-MM-DD")}},{dataIndex:"id",hideInTable:!0,search:!1,formItemProps:{hidden:!0}},{title:"\u64CD\u4F5C",valueType:"option",render:function(a,e){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A.Z,{type:"link",onClick:function(){return x({visible:!0,defaultFormValues:(0,u.Z)((0,u.Z)({},e),{},{startAt:B().unix(e.startAt),endAt:B().unix(e.endAt)}),title:"\u7F16\u8F91"})},children:"\u7F16\u8F91"}),(0,r.jsx)(A.Z,{danger:!0,type:"link",onClick:function(){return S(e.id)},children:"\u5220\u9664"})]})}}]},[]),i=Ae({columns:t,request:(0,Re.yd)(X.b7)}),o=i.proTableProps,h=i.proFormModalProps,x=i.setModal,d=i.reload,g=i.modal,p=(0,v.useCallback)(function(s){var a=(0,X.ul)((0,u.Z)((0,u.Z)({},s),{},{createdAt:B()(s.createdAt).unix()}));return a.then(function(e){var l=e.code,m=e.message;l===0?(L.ZP.success("\u65B0\u589E\u6210\u529F"),d(),x({visible:!1})):L.ZP.error(m||"\u64CD\u4F5C\u5931\u8D25")})},[]),S=(0,v.useCallback)(function(s){(0,w.WZ)({content:"\u786E\u5B9A\u5220\u9664\u6B64\u6570\u636E\u5417?",onOk:function(){(0,X.wd)(s).then(function(e){var l=e.code,m=e.message;l===0?(L.ZP.success("\u5220\u9664\u6210\u529F"),d(!0)):L.ZP.error(m||"\u5220\u9664\u5931\u8D25")})}})},[]),Z=(0,v.useMemo)(function(){var s=h.columns;return s.map(function(a){return a.dataIndex==="age"?(0,u.Z)((0,u.Z)({},a),{},{valueType:"digit"}):a})},[h.columns]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Ie,(0,u.Z)((0,u.Z)({},o),{},{searchSpan:8,search:{labelWidth:150,defaultCollapsed:!0},scroll:{y:800},addText:"\u65B0\u5EFA",extraActions:(0,r.jsx)(Ne,{name:"\u5BFC\u5165",service:function(){return(0,X.b7)({})},reload:d,template:"/aa.xlsx",tootip:"\u4EC5\u652F\u6301xlsx\u683C\u5F0F\u6587\u4EF6,\u6587\u4EF6\u5C0F\u4E8E30MB",accept:".xlsx",children:(0,r.jsx)(A.Z,{type:"primary",children:"\u5BFC\u5165"})}),className:be()._table})),(0,r.jsx)(Te,(0,u.Z)((0,u.Z)({},h),{},{columns:Z,onSubmit:p,modelProps:{width:700},form:{labelCol:{span:5}}}))]})}function $e(t){return(0,r.jsxs)("div",{style:{display:"flex"},children:[(0,r.jsx)(De.Z,{name:"phone",rules:[{required:!0},w.Um]}),(0,r.jsx)(A.Z,{type:"link",children:"\u83B7\u53D6\u6388\u6743\u7801"})]})}},91156:function(U,K,n){"use strict";n.d(K,{b7:function(){return L},ul:function(){return se},wd:function(){return u},A$:function(){return ee}});var J=n(42122);function L(f){return console.log(f),Promise.resolve({code:0,data:{list:[{name:"text",age:25.5,sex:"female",imgs:"https://ruler-recognition.oss-cn-beijing.aliyuncs.com/original/2023-06-01/CMD1000014/CMD1000014_2023-06-01--18:00:16.jpg",time:1703389324,select:"",startAt:1703389324,endAt:1703389824}],total:10}});return(0,J.U2)("/device/list",f)}function se(f){return(0,J.v_)("/plan",f)}function A(f){return put("/plan",f)}function u(f){return(0,J.IV)("/plan/".concat(f))}function b(){return get("/plan/strategy")}function fe(f){return post("/plan/strategy",f)}function Q(f){return put("/plan/strategy",f)}function ve(f){return get("/plan/record/list",f)}function oe(f){return get("/plan/record/receive",f)}function me(f){return get("/plan/record/statistics",{emergencyPlanRecordId:f})}function _(f){return put("/plan/record",f)}function ee(){return Promise.resolve({code:0,message:"0",data:[{url:"https://dadixinya.oss-cn-beijing.aliyuncs.com/forcast_rain/chen-minute-30/20231129/20231129_114800_0i.png",timestamp:1701229680,lngs:[97,109],lats:[25,35]},{url:"https://ftp.bmp.ovh/imgs/2021/03/ebdaef31d93d10b5.png",timestamp:1701230040,lngs:[97,109],lats:[25,35]}]})}},18685:function(){}}]);
