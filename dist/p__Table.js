(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[310],{90813:function($){$.exports={start:"start___3TT4V",loading:"loading___2O2h9",end:"end___34l8P"}},18778:function($){$.exports={table:"table___3IxDk",modal:"modal___LVRzp",form:"form___zeDs-"}},97796:function($){$.exports={_table:"_table___3odCR"}},10402:function($,te,r){"use strict";r.r(te),r.d(te,{default:function(){return Le}});var Ve=r(34792),U=r(48086),$e=r(57663),A=r(71577),c=r(11849),b=r(2824),Ue=r(13062),Q=r(71230),ze=r(89032),ue=r(15746),Ge=r(71194),ne=r(50146),de=r(32059),re=r(93224),ce=r(86582),fe=r(76570),ve=r(49101),ae=r(90213),me=r(94184),xe=r.n(me),he=r(82492),X=r.n(he),ge=r(30381),B=r.n(ge),f=r(67294),pe=r(18778),le=r.n(pe),n=r(85893),Ce=["onSubmit","modal","setModal","hasRestFooter","refreshTime","modelProps","onCancel"],ye=["searchSpan","extraActions","addText","addButtonProps","hideSearchButton","className","actionRef","setModal"],Fe={title:"\u5E8F\u53F7",valueType:"index",key:"index",width:100,render:function(i,s,m,x){var u=x.pageInfo;u=u===void 0?{}:u;var h=u.pageSize,g=h===void 0?0:h,F=u.current,Z=F===void 0?1:F;return(0,n.jsx)("div",{style:{padding:"5px 0"},children:Z*g+m+1-g})}};function Ze(e){var i=e.columns,s=e.request,m=e.showIndexColumn,x=m===void 0?!0:m,u=(0,f.useMemo)(function(){return(x?[Fe].concat((0,ce.Z)(i)):i).map(function(t){return X()({align:t.valueType==="option"?"center":void 0,fieldProps:{allowClear:t.valueType!=="digit"?!0:void 0,placeholder:null},filters:void 0},t)})},[i]),h=(0,f.useRef)(),g=(0,f.useCallback)(function(t){var l;return(l=h.current)===null||l===void 0?void 0:l.reload(t)},[h]),F=(0,f.useState)({visible:!1}),Z=(0,b.Z)(F,2),o=Z[0],a=Z[1];return{setModal:a,modal:o,reload:g,proTableProps:{request:s,columns:u,setModal:a,actionRef:h,rowKey:"id"},proFormModalProps:{modal:o,setModal:a,columns:u}}}function Se(e){var i=e.onSubmit,s=e.modal,m=e.setModal,x=e.hasRestFooter,u=x===void 0?!1:x,h=e.refreshTime,g=h===void 0?{flag:!1,name:"createdAt"}:h,F=e.modelProps,Z=e.onCancel,o=Z===void 0?!1:Z,a=(0,re.Z)(e,Ce),t=(0,f.useRef)();(0,f.useEffect)(function(){var S=null,d=s.isAdd,y=s.visible,D=s.title;return(d||D==="\u5904\u7406")&&g.flag&&y&&(S=setInterval(function(){var M,L;return(M=t.current)===null||M===void 0?void 0:M.setFieldsValue((0,c.Z)((0,c.Z)({},(L=t.current)===null||L===void 0?void 0:L.getFieldsValue()),{},(0,de.Z)({},g==null?void 0:g.name,B()())))},1e3)),function(){S&&clearInterval(S)}},[s.visible,s.isAdd,g,s.title]),(0,f.useEffect)(function(){m(function(S){return(0,c.Z)((0,c.Z)({},S),{},{isAdd:!s.defaultFormValues})})},[s.visible,s.defaultFormValues]),(0,f.useEffect)(function(){var S=s.visible,d=s.defaultFormValues;if(S){var y,D;(y=t.current)===null||y===void 0||y.resetFields(),d&&((D=t.current)===null||D===void 0||D.setFieldsValue(d))}},[s.visible,s.defaultFormValues]);var l=(0,f.useMemo)(function(){return X()({form:{layout:"horizontal"}},a)},[a]),v=(0,f.useState)(!1),p=(0,b.Z)(v,2),I=p[0],R=p[1];return(0,n.jsx)(ne.Z,(0,c.Z)((0,c.Z)((0,c.Z)({visible:s.visible,title:s.title,className:le().modal,onCancel:function(){var d,y;o&&o((d=t.current)===null||d===void 0?void 0:d.getFieldsValue()),(y=t.current)===null||y===void 0||y.setFieldsValue({file:[]}),m({visible:!1})},forceRender:!0,maskClosable:!1,onOk:function(){var d;return(d=t.current)===null||d===void 0?void 0:d.validateFields().then(function(y){return R(!0),i==null?void 0:i(y)}).finally(function(){return R(!1)})},okButtonProps:{loading:I}},u&&{footer:[(0,n.jsx)(A.Z,{onClick:function(){var d;return(d=t.current)===null||d===void 0?void 0:d.setFieldsValue((0,c.Z)((0,c.Z)({},s.defaultFormValues),{},{content:"",result:""}))},children:"\u91CD\u7F6E"}),(0,n.jsx)(A.Z,{type:"primary",onClick:function(){var d;return(d=t.current)===null||d===void 0?void 0:d.validateFields().then(function(y){return R(!0),i==null?void 0:i(y)}).finally(function(){return R(!1)})},children:"\u4FDD\u5B58"})]}),F),{},{children:(0,n.jsx)(ae.ZP,(0,c.Z)({type:"form",formRef:t},l))}))}function Pe(e){var i=e.searchSpan,s=i===void 0?6:i,m=e.extraActions,x=e.addText,u=e.addButtonProps,h=e.hideSearchButton,g=e.className,F=e.actionRef,Z=e.setModal,o=(0,re.Z)(e,ye),a=X()({options:!1,toolBarRender:!1,actionRef:F,pagination:{size:"default",defaultPageSize:10,showSizeChanger:!0},className:xe()(le().table,g),search:{span:s,optionRender:function(l,v,p){return(0,n.jsxs)(Q.Z,{justify:"space-between",children:[h?(0,n.jsx)("span",{}):f.cloneElement(p[1],{icon:(0,n.jsx)(fe.Z,{})}),(0,n.jsxs)(ue.Z,{children:[x&&(0,n.jsx)(A.Z,(0,c.Z)((0,c.Z)({type:"primary",icon:(0,n.jsx)(ve.Z,{}),onClick:function(){return Z({visible:!0,title:x})}},u),{},{children:x})),e.extraActions]})]})}}},o);return(0,n.jsx)(ae.ZP,(0,c.Z)({},a))}var H=r(42122);function oe(e){return console.log(e),Promise.resolve({code:0,data:{list:[{name:"text",age:25.5,sex:"female",imgs:"https://ruler-recognition.oss-cn-beijing.aliyuncs.com/original/2023-06-01/CMD1000014/CMD1000014_2023-06-01--18:00:16.jpg",time:1703389324,select:"",startAt:1703389324,endAt:1703389824}],total:10}});return(0,H.U2)("/device/list",e)}function je(e){return(0,H.v_)("/plan",e)}function ke(e){return put("/plan",e)}function Te(e){return(0,H.IV)("/plan/".concat(e))}function We(){return get("/plan/strategy")}function Ye(e){return post("/plan/strategy",e)}function He(e){return put("/plan/strategy",e)}function Ke(e){return get("/plan/record/list",e)}function Je(e){return get("/plan/record/receive",e)}function Qe(e){return get("/plan/record/statistics",{emergencyPlanRecordId:e})}function Xe(e){return put("/plan/record",e)}var K=r(17024),Ae=r(5966),Ie=r(97796),Re=r.n(Ie),we=r(20228),De=r(11382),qe=r(54421),w=r(38272),_e=r(402),G=r(61859),et=r(43185),se=r(94412),Be=r(7085),k=r(51459),Ee=r(90813),q=r.n(Ee);function be(e){var i=e.template,s=e.service,m=e.name,x=e.reload,u=e.tootip,h=e.accept,g=h===void 0?".xls,.xlsx":h,F=e.validator,Z=(0,f.useState)(!1),o=(0,b.Z)(Z,2),a=o[0],t=o[1],l=(0,f.useState)(C.START),v=(0,b.Z)(l,2),p=v[0],I=v[1],R=(0,f.useState)({success:0,failed:[]}),S=(0,b.Z)(R,2),d=S[0],y=S[1],D=(0,f.useState)([]),M=(0,b.Z)(D,2),L=M[0],V=M[1],z=(0,f.useRef)(),_=(0,f.useCallback)(function(T,O){return O&&!O(T)?se.Z.LIST_IGNORE:(z.current=T,!1)},[]),W=(0,f.useCallback)(function(){if(!z.current)return U.ZP.error("\u8BF7\u9009\u62E9\u6587\u4EF6\uFF01");I(C.LOADING),s(z.current).then(function(T){var O=T.code,ee=T.data,Oe=T.message;if(O!==0)throw Oe;y(ee),I(C.END)}).catch(function(T){U.ZP.error(T||"\u5BFC\u5165\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),I(C.START)})},[]),N=(0,f.useCallback)(function(){p===C.END&&(x==null||x(!0)),I(C.START),V([]),z.current=void 0,t(!1)},[p]),E,P;if(p===C.START)E=(0,n.jsxs)(w.ZP,{className:q().start,children:[(0,n.jsx)(Q.Z,{className:"title",children:"\u8BF7\u6309\u6A21\u677F\u6807\u51C6\u683C\u5F0F\u5BFC\u5165\u6570\u636E"}),(0,n.jsx)(Q.Z,{className:"template-link",children:(0,n.jsx)(G.Z.Link,{href:i,download:!0,children:"\u4E0B\u8F7D\u5BFC\u5165\u6A21\u677F"})}),(0,n.jsx)(se.Z,{beforeUpload:function(O){return _(O,F)},accept:g,showUploadList:{showRemoveIcon:!1},fileList:L,onChange:function(O){var ee=O.fileList;return V(ee.slice(-1))},children:(0,n.jsx)(A.Z,{type:"primary",ghost:!0,children:"\u9009\u62E9\u6587\u4EF6"})}),(0,n.jsx)("span",{className:"tooltip",children:u})]}),P=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(A.Z,{onClick:N,children:"\u53D6\u6D88"}),(0,n.jsx)(A.Z,{onClick:W,type:"primary",children:"\u5BFC\u5165"})]});else if(p===C.LOADING)E=(0,n.jsx)(w.ZP,{className:q().loading,children:(0,n.jsx)(De.Z,{indicator:(0,n.jsx)(Be.Z,{style:{fontSize:40},spin:!0}),tip:"\u5BFC\u5165\u4E2D"})}),P=null;else{var j=d,Y=j.success,J=j.failed;E=(0,n.jsxs)(w.ZP,{className:q().end,children:[(0,n.jsxs)(G.Z,{children:["\u5BFC\u5165\u5B8C\u6210\uFF0C\u5B8C\u6210",(0,n.jsx)(G.Z.Text,{style:{padding:"0 4px"},strong:!0,children:Y}),"\u6761\uFF0C\u5931\u8D25",(0,n.jsx)(G.Z.Text,{style:{padding:"0 4px"},strong:!0,type:J.length?"danger":void 0,children:J.length}),"\u6761"]}),J.length>0&&(0,n.jsx)(G.Z.Link,{onClick:function(){return Me(J,m)},children:"\u4E0B\u8F7D\u5931\u8D25\u65E5\u5FD7"})]}),P=(0,n.jsx)(A.Z,{onClick:N,type:"primary",children:"\u786E\u5B9A"})}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{onClick:function(){return t(!0)},children:e.children}),(0,n.jsx)(ne.Z,{title:"\u5BFC\u5165".concat(m),visible:a,maskClosable:!1,footer:P,onCancel:N,children:E})]})}var C;(function(e){e[e.START=0]="START",e[e.LOADING=1]="LOADING",e[e.END=2]="END"})(C||(C={}));function Me(e,i){var s=[["\u884C\u53F7","\u5931\u8D25\u539F\u56E0"]],m=k.utils.aoa_to_sheet(s),x=k.utils.sheet_add_aoa(m,e.map(function(h){var g=h.index,F=h.reason;return[g,F]}),{origin:"A2"}),u=k.utils.book_new();k.utils.book_append_sheet(u,x),(0,k.writeFile)(u,"".concat(i,"\u5BFC\u5165\u5931\u8D25\u65E5\u5FD7").concat(B()().format("YYYYMMDDHHmmss"),".xlsx"))}function tt(e){var i=e.service,s=e.name,m=e.reload,x=e.tootip,u=e.accept,h=u===void 0?".xls,.xlsx":u,g=e.validator,F=useState(!1),Z=_slicedToArray(F,2),o=Z[0],a=Z[1],t=useState(C.START),l=_slicedToArray(t,2),v=l[0],p=l[1],I=useState(!1),R=_slicedToArray(I,2),S=R[0],d=R[1],y=useState([]),D=_slicedToArray(y,2),M=D[0],L=D[1],V=useRef(),z=useCallback(function(P,j){return j&&!j(P)?_Upload.LIST_IGNORE:(V.current=P,!1)},[]),_=useCallback(function(){if(!V.current)return _message.error("\u8BF7\u9009\u62E9\u6587\u4EF6\uFF01");p(C.LOADING),i(V.current).then(function(P){var j=P.code,Y=P.message;if(d(j===0),j!==0)throw Y;p(C.END)}).catch(function(P){_message.error(P||"\u5BFC\u5165\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),p(C.START)})},[]),W=useCallback(function(){v===C.END&&(m==null||m()),p(C.START),L([]),V.current=void 0,a(!1)},[v]),N,E;return v===C.START?(N=_jsxs(_List,{className:style.start,children:[_jsx(_Upload,{beforeUpload:function(j){return z(j,g)},accept:h,fileList:M,onChange:function(j){var Y=j.fileList;return L(Y.slice(-1))},children:_jsx(_Button,{type:"primary",ghost:!0,children:"\u9009\u62E9\u6587\u4EF6"})}),_jsx("span",{className:"tooltip",children:x})]}),E=_jsxs(_Fragment,{children:[_jsx(_Button,{onClick:W,children:"\u53D6\u6D88"}),_jsx(_Button,{onClick:_,type:"primary",children:"\u5BFC\u5165"})]})):v===C.LOADING?(N=_jsx(_List,{className:style.loading,children:_jsx(_Spin,{indicator:_jsx(LoadingOutlined,{style:{fontSize:40},spin:!0}),tip:"\u4E0A\u4F20\u4E2D"})}),E=null):(N=_jsx(_List,{className:style.end,children:_jsx(_Typography,{children:S?"\u4E0A\u4F20\u5B8C\u6210":"\u4E0A\u4F20\u5931\u8D25"})}),E=_jsx(_Button,{onClick:W,type:"primary",children:"\u786E\u5B9A"})),_jsxs(_Fragment,{children:[_jsx("span",{onClick:function(){return a(!0)},children:e.children}),_jsx(_Modal,{title:"\u4E0A\u4F20".concat(s),visible:o,maskClosable:!1,footer:E,onCancel:W,children:N})]})}var ie=r(8403);function Le(){var e=(0,f.useMemo)(function(){return[{title:function(a,t){return t==="table"?"\u5B57\u7B26\u4E32":"\u540D\u5B57(\u5B57\u7B26\u4E32"},dataIndex:"name",formItemProps:{rules:[{required:!0},{max:30}]}},{title:"\u6570\u5B57",dataIndex:"age",valueType:"digitRange",formItemProps:{addonAfter:"\u5C81",addonBefore:"+"},fieldProps:{precision:2,min:0,max:120},search:{transform:function(a){if(!a)return{};var t=(0,b.Z)(a,2),l=t[0],v=t[1];return{minAge:l,maxAge:v}}},render:function(a,t){var l=t.age;return l}},{title:"\u7C7B\u522B",dataIndex:"eventType",valueEnum:(0,ie.KP)(ie.gM),fieldProps:{mode:"multiple",maxTagCount:"responsive"}},{title:"\u7B5B\u9009",dataIndex:"sex",valueEnum:new Map([["female","\u5973"],["male","\u7537"]])},{title:"\u65F6\u95F4",dataIndex:"time",valueType:"dateRange",hideInForm:!0,render:function(a,t){var l=t.time;return(0,K.Pj)(l)},search:{transform:function(a){if(!a)return{};var t=(0,b.Z)(a,2),l=t[0],v=t[1];return{createStartAt:B()(l).startOf("day").unix(),createEndAt:B()(v).endOf("day").unix()}}}},{title:"\u624B\u673A\u53F7",dataIndex:"phone",search:!1,renderText:K.eq,renderFormItem:function(a,t,l){return(0,n.jsx)(Ne,{form:l})}},{title:"\u56FE\u7247",dataIndex:"imgs",valueType:"image",search:!1,hideInForm:!0},{title:"\u5F00\u59CB\u65E5\u671F",dataIndex:"startAt",valueType:"date",search:!1,formItemProps:{rules:[{required:!0,message:"\u8BF7\u9009\u62E9${label}"}]},render:function(a,t){var l=t.startAt;return B().unix(l).format("yyyy-MM-DD")},fieldProps:{allowClear:!1,placeholder:"\u8BF7\u9009\u62E9"}},{title:"\u7ED3\u675F\u65E5\u671F",dataIndex:"endAt",valueType:"date",search:!1,formItemProps:function(a){return{rules:[{required:!0,message:"\u8BF7\u9009\u62E9${label}"},{validator:function(l,v){var p,I=a==null||(p=a.getFieldValue("startAt"))===null||p===void 0?void 0:p.startOf("day").unix(),R=v==null?void 0:v.startOf("day").unix();return R<I?Promise.reject("\u7ED3\u675F\u65E5\u671F\u4E0D\u80FD\u65E9\u4E8E\u5F00\u59CB\u65E5\u671F"):Promise.resolve()}}]}},fieldProps:function(a){var t;console.log(a==null?void 0:a.getFieldValue("startAt"));var l=a==null||(t=a.getFieldValue("startAt"))===null||t===void 0?void 0:t.startOf("day");return{allowClear:!1,placeholder:"\u8BF7\u9009\u62E9",disabledDate:function(p){return p<l}}},render:function(a,t){var l=t.endAt;return B().unix(l).format("yyyy-MM-DD")}},{dataIndex:"id",hideInTable:!0,search:!1,formItemProps:{hidden:!0}},{title:"\u64CD\u4F5C",valueType:"option",render:function(a,t){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(A.Z,{type:"link",onClick:function(){return x({visible:!0,defaultFormValues:(0,c.Z)((0,c.Z)({},t),{},{startAt:B().unix(t.startAt),endAt:B().unix(t.endAt)}),title:"\u7F16\u8F91"})},children:"\u7F16\u8F91"}),(0,n.jsx)(A.Z,{danger:!0,type:"link",onClick:function(){return F(t.id)},children:"\u5220\u9664"})]})}}]},[]),i=Ze({columns:e,request:(0,H.yd)(oe)}),s=i.proTableProps,m=i.proFormModalProps,x=i.setModal,u=i.reload,h=i.modal,g=(0,f.useCallback)(function(o){var a=je((0,c.Z)((0,c.Z)({},o),{},{createdAt:B()(o.createdAt).unix()}));return a.then(function(t){var l=t.code,v=t.message;l===0?(U.ZP.success("\u65B0\u589E\u6210\u529F"),u(),x({visible:!1})):U.ZP.error(v||"\u64CD\u4F5C\u5931\u8D25")})},[]),F=(0,f.useCallback)(function(o){(0,K.WZ)({content:"\u786E\u5B9A\u5220\u9664\u6B64\u6570\u636E\u5417?",onOk:function(){Te(o).then(function(t){var l=t.code,v=t.message;l===0?(U.ZP.success("\u5220\u9664\u6210\u529F"),u(!0)):U.ZP.error(v||"\u5220\u9664\u5931\u8D25")})}})},[]),Z=(0,f.useMemo)(function(){var o=m.columns;return o.map(function(a){return a.dataIndex==="age"?(0,c.Z)((0,c.Z)({},a),{},{valueType:"digit"}):a})},[m.columns]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Pe,(0,c.Z)((0,c.Z)({},s),{},{searchSpan:8,search:{labelWidth:150,defaultCollapsed:!0},scroll:{y:800},addText:"\u65B0\u5EFA",extraActions:(0,n.jsx)(be,{name:"\u5BFC\u5165",service:function(){return oe({})},reload:u,template:"/aa.xlsx",tootip:"\u4EC5\u652F\u6301xlsx\u683C\u5F0F\u6587\u4EF6,\u6587\u4EF6\u5C0F\u4E8E30MB",accept:".xlsx",children:(0,n.jsx)(A.Z,{type:"primary",children:"\u5BFC\u5165"})}),className:Re()._table})),(0,n.jsx)(Se,(0,c.Z)((0,c.Z)({},m),{},{columns:Z,onSubmit:g,modelProps:{width:700},form:{labelCol:{span:5}}}))]})}function Ne(e){return(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsx)(Ae.Z,{name:"phone",rules:[{required:!0},K.Um]}),(0,n.jsx)(A.Z,{type:"link",children:"\u83B7\u53D6\u6388\u6743\u7801"})]})}},18685:function(){}}]);
